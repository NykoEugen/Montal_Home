# Feed Management Commands

Документ описує менеджмент-команди Django, які використовуються для налаштування та імпорту даних із XML/YML фідів постачальників. У прикладах нижче вважаємо, що виконуємо команди з кореня репозиторію:

```bash
source venv/bin/activate
python manage.py <command> [options]
```

## `setup_matroluxe_supplier_feed`

Команда створює або оновлює `SupplierFeedConfig` для каталогу Matroluxe, щоб надалі керувати фідом через кастомну адмінку (розділ **Supplier Feeds**).

```bash
python manage.py setup_matroluxe_supplier_feed \
  [--feed-url https://example.com/feed.yml] \
  [--name "Matroluxe — корпусні меблі"]
```

### Опції

- `--feed-url` – посилання на YML-файл Matroluxe. За замовчуванням використовується офіційний фід `https://matroluxe.ua/index.php?route=extension/feed/yandex_yml8`.
- `--name` – відображувана назва конфігурації у довіднику фідів (за замовчуванням `Matroluxe — корпусні меблі`).

Після виконання команда повідомить, чи конфігурацію створено вперше, чи оновлено існуючу, після чого можна запускати оновлення або тестовий розбір фіду в адмінці.

## `import_supplier_furniture`

Основний інструмент для одноразового (або контрольованого) імпорту товарів із XML-фіду постачальника у моделі `Furniture`, `FurnitureSizeVariant` та ін. Команда аналізує категорії фіду, мапить їх на підкатегорії сайту та створює товари з параметрами та зображеннями.

```bash
python manage.py import_supplier_furniture \
  --feed-url https://example.com/feed.xml \
  [options]
```

### Обовʼязкові параметри

- Потрібно вказати **або** `--feed-url` (HTTP/HTTPS посилання), **або** `--feed-file` (локальний шлях до XML).

### Корисні прапорці та аргументи

- `--profile {furniture,mattresses}` – визначає набір категорій і логіку розбору (корпусні меблі за замовчуванням або матраци).
- `--categories "Назва Категорії" ...` – обмежити імпорт конкретними назвами категорій з фіду (порівняння за текстом).
- `--category-map FEED_NAME=SUBCATEGORY_NAME` – примусове відображення категорії з фіду на підкатегорію сайту; аргумент можна повторювати.
- `--category-id-map FEED_ID=SUBCATEGORY_NAME` – те саме, але привʼязка за `categoryId` з фіду (має вищий пріоритет).
- `--dry-run` – показує, що буде створено, без запису у базу.
- `--limit N` – обмежити кількість оброблених пропозицій (зручно для тестів).

### Типовий сценарій імпорту

1. **Протестувати на невеликій вибірці**:

   ```bash
   python manage.py import_supplier_furniture \
     --feed-url https://example.com/feed.xml \
     --limit 20 \
     --dry-run
   ```

   Так можна перевірити логування та відповідність категорій без змін у БД.

2. **Налаштувати мапінг підкатегорій** (за потреби):

   ```bash
   python manage.py import_supplier_furniture \
     --feed-url https://example.com/feed.xml \
     --category-map "Шафи=Шафи" \
     --category-map "Комоди=Комоди"
   ```

3. **Запустити повний імпорт** (без `--dry-run`). Перед запуском бажано зробити резервну копію БД, оскільки команда створює/оновлює товари.

### Додаткові поради

- Команда зберігає зображення у `media/` і може завантажувати їх за посиланнями, тож переконайтеся, що мережевий доступ дозволений.
- Якщо завантажуєте локальний файл (`--feed-file`), вкажіть абсолютний або відносний шлях від кореня проєкту.
- Логи та попередження (наприклад, коли не вдалось визначити підкатегорію) пишуться у консоль, тож перегляньте їх після імпорту.

---

Якщо потрібні додаткові команди для роботи з фідом або інтеграція з іншими постачальниками, їх краще оформлювати в окремих менеджмент-командах за аналогією з описаними вище та доповнювати цей документ.
